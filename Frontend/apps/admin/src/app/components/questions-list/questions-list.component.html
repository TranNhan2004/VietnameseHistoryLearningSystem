<div class="p-4">
  <h1 class="mt-5 font-bold text-my-blue text-4xl text-left">{{ title }}</h1>
  <div class="mt-2 h-1 w-full bg-gradient-to-r from-my-blue to-my-coralaccent rounded-lg"></div>

  <div class="flex items-center justify-between mt-5">
    <div class="w-[40%]">
      <app-search
        [originalData]="originalDisplayedData"
        [searchKeys]="['content']"
        (filterData)="filterData($event)"
        placeholder="Tìm kiếm theo nội dung"
      >
      </app-search>
    </div>
    <div class="flex items-center space-x-4">
      <app-sort
        selectNgClass="p-[5.5%]"
        [originalData]="originalDisplayedData"
        [sortOptions]="[
          { label: 'Nội dung câu hỏi (A-Z)', type: 'asc', sortedKey: 'content' },
          { label: 'Nội dung câu hỏi (Z-A)', type: 'dsc', sortedKey: 'content' },
        ]"
        (sortData)="sortData($event)"
      >
      </app-sort>
      <lib-action-button
        [name]="ActionButtonName.Add"
        mainTitle="Chọn câu hỏi"
        title=""
        (btnClick)="selectData()"
      ></lib-action-button>
    </div>
  </div>

  <div class="mt-5">
    <div class="grid grid-cols-2 gap-4">
      @for (item of displayedData; track item.id; let i = $index) {
        <app-pi-card
          [id]="item.id"
          [ordinalNumber]="i + 1"
          [notEdit]="notUpdateQuestion"
          (editFn)="updateQuestion.emit(item.id)"
          (deleteFn)="deleteQuestion.emit(item.id)"
        >
          <div class="flex flex-col text-justify text-gray-800 space-y-2">


            @if (hasContest()) {
              <p class="font-medium">{{ cast(item).content }} ({{ getPoint(item) }} điểm)</p>
              <p class="mt-1 italic text-gray-500">
                {{ getFormattedPointAllocationRule(item) }}
              </p>
            } @else {
              <p class="font-medium">{{ cast(item).content }}</p>
            }

            @for (answerOption of cast(item).answerOptions; track answerOption.id; let i = $index) {
              <div
                class="flex items-start p-2 rounded-md"
                [ngClass]="answerOption.correct ? 'bg-green-100 text-green-700' : ''"
              >
                <p class="w-[5%]">{{ String.fromCharCode(i + 'A'.charCodeAt(0)) }}.</p>
                <p class="w-full flex items-center">
                  <span>{{ answerOption.content }}</span>
                  <ng-icon
                    *ngIf="answerOption.correct"
                    size="24"
                    name="matDoneRound"
                    color="green"
                    class="ml-auto"
                  ></ng-icon>
                </p>
              </div>
            }
          </div>
        </app-pi-card>
      }
    </div>


  </div>
</div>

<app-modal [showModal]="showAddModal">
  <div class="p-4">
    <h3 class="text-2xl font-bold mb-1 text-my-blue">Chọn câu hỏi</h3>
    <div class="mt-2 h-1 w-full bg-gradient-to-r from-my-blue to-my-coralaccent rounded-lg"></div>

    <div class="flex items-center justify-between mt-5">
      <div class="w-[40%]">
        <app-search
          [originalData]="originalAllQuestions"
          [searchKeys]="['content']"
          (filterData)="filterAllQuestions($event)"
          placeholder="Tìm kiếm theo nội dung"
        >
        </app-search>
      </div>
      <div class="flex items-center space-x-4">
        <app-sort
          selectNgClass="p-[5.5%]"
          [originalData]="originalAllQuestions"
          [sortOptions]="[
            { label: 'Nội dung câu hỏi (A-Z)', type: 'asc', sortedKey: 'content' },
            { label: 'Nội dung câu hỏi (Z-A)', type: 'dsc', sortedKey: 'content' },
          ]"
          (sortData)="sortAllQuestions($event)"
        >
        </app-sort>
      </div>
    </div>

    @if (noteAddModal) {
      <p class="mt-1 italic text-gray-500">
        {{ noteAddModal }}
      </p>
    }

    <div class="mt-5">
      <app-questions-table
        [displayedQuestions]="displayedAllQuestions"
        (choose)="selectedQuestionIdsChange.emit($event)"
      >
      </app-questions-table>
    </div>

    <div class="mt-10 p-4 w-full bg-gradient-to-r from-my-lightblue to-my-lightpurple flex items-center rounded-xl">
      <div class="flex justify-end ml-auto space-x-2 ">
        <lib-action-button
          [name]="ActionButtonName.Save"
          mainTitle="Lưu"
          title=""
          (btnClick)="saveSelected()"
        ></lib-action-button>

        <lib-action-button
          [name]="ActionButtonName.Cancel"
          mainTitle="Thoát"
          title=""
          (btnClick)="closeAddModal()"
        ></lib-action-button>
      </div>
    </div>
  </div>
</app-modal>
