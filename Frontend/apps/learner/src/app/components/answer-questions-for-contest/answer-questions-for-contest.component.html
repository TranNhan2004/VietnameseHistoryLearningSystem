<div class="flex justify-end mb-4">
  <div class="border border-red-500 bg-red-50 text-red-600 px-4 py-2 rounded-lg font-semibold shadow flex items-center">
    <ng-icon name="matTimerRound" class="mr-2" size="28"></ng-icon>
    <p>Thời gian còn lại: {{ minutes }}:{{ seconds | number:'2.0' }}</p>
  </div>
</div>

<div class="flex justify-between items-center mb-4">
  <div class="flex flex-wrap gap-2 max-w-[90%]">
    @for (question of questionResponses; track question.id; let idx = $index) {
      <button
        class="relative w-10 h-10 rounded-full flex items-center justify-center border transition
               hover:scale-105 hover:shadow-md active:scale-95"
        [ngClass]="{
          'bg-white text-gray-800': !isChosen(question.id),
          'bg-blue-500 text-white': isChosen(question.id)
        }"
        (click)="currentPage = Math.floor(idx / questionsPerPage)"
      >
        {{ idx + 1 }}
        <span
          *ngIf="isFlagged(question.id)"
          class="absolute top-0 right-0 w-2 h-2 bg-orange-500 rounded-full"
        ></span>
      </button>
    }
  </div>

  <lib-action-button
    [name]="ActionButtonName.SubmitQuiz"
    mainTitle="Nộp bài"
    title=""
    (btnClick)="submitAnswersLogWarning()"
  >
  </lib-action-button>
</div>

<div class="space-y-6">
  @for (question of paginatedQuestions; track question.id; let i = $index) {
    <div class="p-4 border border-gray-300 rounded-xl shadow-sm bg-white">
      <p class="font-semibold text-lg mb-3">
        {{ currentPage * questionsPerPage + i + 1 }}. {{ question.content }}
      </p>

      <ul class="space-y-2 mb-3">
        @for (option of question.answerOptions; track option.id) {
          <li>
            <label
              class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded-lg transition"
            >
              <input
                type="checkbox"
                class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                [checked]="isChecked(question.id, option.id)"
                (change)="toggleAnswer(question.id, option.id, $event)"
              />
              <span class="text-gray-700">{{ option.content }}</span>
            </label>
          </li>
        }
      </ul>

      <button
        class="flex items-center gap-1 text-sm transition hover:scale-105 active:scale-95"
        [ngClass]="{
          'text-gray-500': !isFlagged(question.id),
          'text-red-500': isFlagged(question.id)
        }"
        (click)="toggleFlag(question.id)"
      >
        <ng-icon name="matFlagRound" size="24"></ng-icon>
        {{ isFlagged(question.id) ? 'Bỏ cờ' : 'Đặt cờ' }}
      </button>
    </div>
  }
</div>

<div class="flex justify-between mt-4">
  <button
    class="px-4 py-2 bg-gray-200 rounded disabled:opacity-50 transition
           hover:bg-gray-300 hover:shadow-md active:scale-95"
    (click)="prevPage()"
    [disabled]="currentPage === 0"
  >
    Trước
  </button>
  <button
    class="px-4 py-2 bg-gray-200 rounded disabled:opacity-50 transition
           hover:bg-gray-300 hover:shadow-md active:scale-95"
    (click)="nextPage()"
    [disabled]="(currentPage + 1) * questionsPerPage >= questionResponses.length"
  >
    Sau
  </button>
</div>
